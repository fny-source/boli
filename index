<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>æ€¨ç§å¥³é…æ€æ¡Œå½• Â· å®Œæ•´ç‰ˆ</title>

<style>
:root{
  --bg:#0f1220;
  --card:#1b1f3a;
  --card2:#14182e;
  --text:#eaeaff;
  --muted:#b7b9ff;
  --border:#3b3f7a;
  --accent:#ff6aa2;
  --good:#7cffb2;
  --warn:#ffd36b;
  --bad:#ff5b5b;
  --glow:#ff6aa288;
  --shadow:0 0 12px #0007;
  --r:14px;
}
*{box-sizing:border-box}
body{
  margin:0;
  color:var(--text);
  font-family:"PingFang SC","Microsoft YaHei",system-ui,-apple-system,Segoe UI,Roboto,Arial;
  background: radial-gradient(1200px 800px at 20% 0%, #1a1f44 0%, var(--bg) 55%, #0b0d18 100%);
}
.container{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:12px;
  padding:12px;
}
.card{
  background:linear-gradient(180deg,var(--card) 0%,var(--card2) 100%);
  border:1px solid var(--border);
  border-radius:var(--r);
  padding:14px;
  box-shadow:var(--shadow);
}
h3{margin:0 0 10px;color:var(--accent);font-size:16px}
.small{font-size:12px;color:var(--muted)}
@media(max-width:820px){.container{grid-template-columns:1fr}}

#story{height:280px;overflow:auto;line-height:1.8}

.option{
  background:#242a62;
  border:1px solid #2f3578;
  padding:10px;
  margin:8px 0;
  border-radius:10px;
  cursor:pointer;
}
.option:hover{border-color:var(--accent);box-shadow:0 0 10px var(--glow)}
.highlight{border-color:var(--accent)}

.stat{display:flex;justify-content:space-between;font-size:13px;margin:4px 0}

.btn{
  padding:8px 10px;
  border-radius:10px;
  border:1px solid #ffffff22;
  background:#20245a;
  color:#fff;
  cursor:pointer;
  margin:4px;
}
.btn:hover{border-color:var(--accent)}

.mask{position:fixed;inset:0;background:#00000088;display:none;align-items:center;justify-content:center}
.mask.show{display:flex}

.modal{
  width:min(780px,92vw);
  background:#1b1f3a;
  padding:14px;
  border-radius:14px;
}

.float{
  position:fixed;top:14px;right:14px;
  padding:8px 10px;
  border-radius:10px;
  background:#12152a;
  animation:floatUp 1.4s ease-out forwards;
}
@keyframes floatUp{to{opacity:0;transform:translateY(-40px)}}
</style>
</head>

<body>

<div class="container">

<div class="card">
<h3>ğŸ“œ å‰§æƒ…</h3>
<div id="story"></div>
</div>

<div class="card">
<h3>ğŸ¯ è¡ŒåŠ¨</h3>
<div id="options"></div>
<button class="btn" id="btnCustom">è‡ªå®šä¹‰è¡ŒåŠ¨</button>
<button class="btn" id="btnEnd">ç»“æŸå›åˆ</button>
</div>

<div class="card">
<h3>ğŸ“Š å±æ€§</h3>
<div id="stats"></div>
</div>

<div class="card">
<h3>âš™ ç³»ç»Ÿ</h3>
<div id="system"></div>
<button class="btn" id="btnShop">å•†åŸ</button>
<button class="btn" id="btnSave">å­˜æ¡£</button>
<button class="btn" id="btnLoad">è¯»æ¡£</button>
<button class="btn" id="btnReset">é‡å¼€</button>
</div>

</div>

<div class="mask" id="shopMask">
<div class="modal">
<h3>ç³»ç»Ÿå•†åŸ</h3>
<div id="shopMoney"></div>
<div id="shopGrid"></div>
<button class="btn" id="btnCloseShop">å…³é—­</button>
</div>
</div>

<script>

const Plot={
1:{
 intro:`ä½ çå¼€çœ¼ï¼Œå‘ç°è‡ªå·±ç©¿æˆè™æ–‡å¥³é…æŸ³æ‰¶é£ã€‚

ç³»ç»Ÿå‘å¸ƒä»»åŠ¡ï¼šå»ä¸œå®«é€æ±¤ã€‚

ä½ å†·ç¬‘ï¼šè¿™ä¸€ä¸–æˆ‘è¦æ€æ¡Œã€‚`,
 options(){
 return[
 {id:"p1",story:`ä½ ä¹–ä¹–å»é€æ±¤ï¼Œè¢«è‹æ¸…è²ç®—è®¡æˆç¬‘è¯ã€‚`,effect:{è´µå¥³å£°æœ›:-5}},
 {id:"p2",story:`ä½ å½“ä¼—å€’æ±¤æ€æ¡Œï¼Œå…¨åŸéœ‡åŠ¨ã€‚`,effect:{æ€æ¡Œå€¼:6,åç¦»åº¦:4},highlight:true},
 {id:"p3",story:`ä½ æš—æŸ¥è‹æ¸…è²ï¼Œå‘ç°å¼‚å¸¸ã€‚`,effect:{è°‹ç•¥:3,åç¦»åº¦:2}},
 {id:"p4",story:`ä½ ä¼‘å…»ç”Ÿæ¯ç¨³ä½çŠ¶æ€ã€‚`,effect:{å¥åº·:4,å¿ƒæ™º:3}}
 ];
}
}
};

const Shop=[
{id:"shield",name:"å±è”½ç¬¦",price:10,apply:s=>s.buffs.noPunishOnce=true}
];

const State={
day:1,
phase:"CHOOSE",
player:{
é£å:92,è°‹ç•¥:78,å¿ƒæ™º:74,å¥åº·:88,
æ€æ¡Œå€¼:0,åç¦»åº¦:0,è´µå¥³å£°æœ›:85,ç³»ç»Ÿè­¦å‘Šå€¼:0
},
buffs:{noPunishOnce:false}
};

const $=id=>document.getElementById(id);

function typeText(t){
$("story").innerHTML="";
let i=0;
let s=setInterval(()=>{
 $("story").innerHTML+=t[i]||"";
 i++; if(i>=t.length) clearInterval(s);
},15);
}

function renderStats(){
$("stats").innerHTML="";
for(let k in State.player){
 $("stats").innerHTML+=`<div class="stat"><span>${k}</span><span>${State.player[k]}</span></div>`;
}
}

function renderOptions(){
$("options").innerHTML="";
Plot[State.day].options().forEach(op=>{
 let d=document.createElement("div");
 d.className="option";
 if(op.highlight) d.classList.add("highlight");
 d.innerText=op.story.split("\n")[0];
 d.onclick=()=>applyAction(op);
 $("options").appendChild(d);
});
}

function renderSystem(msg){
$("system").innerHTML=`ç¬¬${State.day}æ—¥<br>${msg||""}`;
}

function tip(t){
 let d=document.createElement("div");
 d.className="float"; d.innerText=t;
 document.body.appendChild(d);
 setTimeout(()=>d.remove(),1400);
}

function applyDelta(delta){
 for(let k in delta){
  State.player[k]=(State.player[k]||0)+delta[k];
  tip(`${k} ${delta[k]>0?"+":""}${delta[k]}`);
 }
}

function applyAction(op){
 typeText(op.story);
 applyDelta(op.effect);
 renderStats();
 renderSystem("è¡ŒåŠ¨å®Œæˆ");
 State.phase="DONE";
}

function nextDay(){
 State.day++;
 if(!Plot[State.day]){
  typeText("å½“å‰å‰§æƒ…ç»“æŸï¼Œä½ å¯ä»¥ç»§ç»­æ‰©å±•æ•…äº‹ã€‚");
  $("options").innerHTML="";
  return;
 }
 State.phase="CHOOSE";
 initDay();
}

function initDay(){
 typeText(Plot[State.day].intro);
 renderOptions();
 renderStats();
 renderSystem("è¯·é€‰æ‹©è¡ŒåŠ¨");
}

function customAction(){
 let t=prompt("è¾“å…¥è¡ŒåŠ¨ï¼š");
 if(!t) return;
 typeText("ä½ é€‰æ‹©äº†ï¼š"+t);
 applyDelta({æ€æ¡Œå€¼:2,åç¦»åº¦:1});
 renderStats();
 State.phase="DONE";
}

$("btnEnd").onclick=()=>{ if(State.phase==="DONE") nextDay(); };
$("btnCustom").onclick=customAction;

$("btnShop").onclick=()=>{$("shopMask").classList.add("show");};
$("btnCloseShop").onclick=()=>{$("shopMask").classList.remove("show");};

$("btnSave").onclick=()=>{localStorage.setItem("save",JSON.stringify(State));tip("å·²å­˜æ¡£");};
$("btnLoad").onclick=()=>{let s=localStorage.getItem("save");if(s){Object.assign(State,JSON.parse(s));initDay();tip("å·²è¯»æ¡£");}};
$("btnReset").onclick=()=>{localStorage.clear();location.reload();};

initDay();

</script>
</body>
</html>
