<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>å¤é£æ€¨ç§å¥³é…ä¸Šä½è®°</title>

<style>
body{
background:#0b1020;
color:#eaeaff;
font-family:system-ui;
margin:0;
padding:20px
}

.card{
background:#141a3a;
border-radius:16px;
padding:16px;
margin-bottom:16px;
box-shadow:0 0 18px rgba(120,140,255,.2)
}

h2{color:#ff7acb}

.btn{
background:#2b3cff;
color:white;
border:none;
padding:10px 14px;
border-radius:12px;
margin:6px;
cursor:pointer
}

.btn:hover{opacity:.85}

.option{
border:2px solid #444cff;
padding:12px;
border-radius:12px;
margin:8px 0;
cursor:pointer
}
.option.active{
border-color:#ff7acb;
box-shadow:0 0 10px #ff7acb
}

small{color:#aaa}
</style>
</head>

<body>

<div class="card">
<h2>ğŸ“œ å½“å‰å‰§æƒ… - Day <span id="day"></span></h2>
<div id="story">åŠ è½½ä¸­...</div>
</div>

<div class="card">
<h2>ğŸ¯ è¡ŒåŠ¨é€‰æ‹©</h2>
<div id="actions"></div>

<button class="btn" onclick="endTurn()">ç»“æŸæœ¬å›åˆ</button>
<button class="btn" onclick="aiContinue()">ğŸ¤– AIç»­å†™</button>
<button class="btn" onclick="resetGame()">é‡å¼€</button>
</div>

<div class="card">
<h2>ğŸ“Š çŠ¶æ€</h2>
<div id="stats"></div>
</div>

<script>
const API_URL="https://api.gemai.cc/v1/chat/completions";
const API_KEY="YOUR_API_KEY_HERE";

let game={
day:1,
favor:0,
danger:0,
wisdom:0,
health:10,
story:"ä½ ä½œä¸ºæ€¨ç§å¥³é…ï¼Œè¢«è¿«å·å…¥ä¸œå®«æƒæ–—ã€‚ä»Šæ—¥å¤ªå­é¦–æ¬¡æ³¨æ„åˆ°ä½ ã€‚"
};

let selected=null;

const baseActions=[
{txt:"ç¨³ä½å±€é¢ï¼ˆç¤ºå¼±åšåŒæƒ…ï¼‰",f:{favor:+2,danger:-1}},
{txt:"æ€æ¡Œåå‡»ï¼ˆé«˜é£é™©ï¼‰",f:{favor:-1,danger:+3}},
{txt:"æš—ä¸­å¸ƒå±€ï¼ˆè°‹ç•¥ï¼‰",f:{wisdom:+2}},
{txt:"å…»ç²¾è“„é”ï¼ˆæ¢å¤ï¼‰",f:{health:+2,danger:-1}}
];

function save(){
localStorage.setItem("game",JSON.stringify(game))
}

function load(){
const d=localStorage.getItem("game");
if(d) game=JSON.parse(d);
}

function render(){
document.getElementById("day").innerText=game.day;
document.getElementById("story").innerText=game.story;

let actHTML="";
selected=null;

shuffle([...baseActions]).forEach((a,i)=>{
actHTML+=`
<div class="option" onclick="pick(${i},this)">
<b>${a.txt}</b><br>
<small>å½±å“ï¼š${JSON.stringify(a.f)}</small>
</div>`
});
document.getElementById("actions").innerHTML=actHTML;

document.getElementById("stats").innerHTML=
`å¥½æ„Ÿ:${game.favor} | å±é™©:${game.danger} | å¿ƒæ™º:${game.wisdom} | å¥åº·:${game.health}`;
}

function pick(i,el){
document.querySelectorAll(".option").forEach(o=>o.classList.remove("active"));
el.classList.add("active");
selected=i;
}

function endTurn(){
if(selected===null){
alert("è¯·é€‰æ‹©è¡ŒåŠ¨");
return;
}
const action=baseActions[selected];

for(let k in action.f){
game[k]+=action.f[k];
}

game.day++;

game.story=generateStory();

checkEnding();

save();
render();
}

function generateStory(){
let pool=[
"å¤ªå­å¯¹ä½ å¤šçœ‹äº†ä¸€çœ¼ï¼Œä¼¼ä¹åœ¨è¡¡é‡ä»·å€¼ã€‚",
"å®«ä¸­æµè¨€å¼€å§‹å›´ç»•ä½ ä¼ æ’­ã€‚",
"è´µå¥³å¯¹ä½ æ€åº¦å¾®å¦™å˜åŒ–ã€‚",
"ä½ éšçº¦å¯Ÿè§‰æœ‰äººåœ¨æš—ä¸­é’ˆå¯¹ã€‚",
"å±€åŠ¿æ­£åœ¨æ‚„ç„¶å€¾æ–œã€‚"
];

if(game.favor>5) pool.push("å¤ªå­æ˜æ˜¾åå‘ä½ ã€‚");
if(game.danger>5) pool.push("å±æœºé€¼è¿‘ï¼Œä½ å·²æˆçœ¼ä¸­é’‰ã€‚");
if(game.wisdom>5) pool.push("ä½ å¸ƒå±€æ¸æˆï¼Œæš—çº¿æµ®ç°ã€‚");

return pool[Math.floor(Math.random()*pool.length)];
}

function checkEnding(){
if(game.health<=0){
alert("ä½ ç—…å€’é€€åœºï¼Œå¤±è´¥ç»“å±€");
resetGame();
}
if(game.danger>=10){
alert("ä½ è¢«æ¸…ç®—å‡ºå±€ï¼Œé»‘åŒ–å¤±è´¥ç»“å±€");
resetGame();
}
if(game.favor>=10){
alert("ä½ ç™»ä¸Šé«˜ä½ï¼Œç”œå® å¤§ç»“å±€ï¼");
resetGame();
}
}

function resetGame(){
localStorage.removeItem("game");
game={
day:1,favor:0,danger:0,wisdom:0,health:10,
story:"ä½ ä½œä¸ºæ€¨ç§å¥³é…ï¼Œè¢«è¿«å·å…¥ä¸œå®«æƒæ–—ã€‚ä»Šæ—¥å¤ªå­é¦–æ¬¡æ³¨æ„åˆ°ä½ ã€‚"
};
render();
}

function shuffle(arr){
for(let i=arr.length-1;i>0;i--){
const j=Math.floor(Math.random()*(i+1));
[arr[i],arr[j]]=[arr[j],arr[i]];
}
return arr;
}

async function aiContinue(){
const prompt=`ä½ æ˜¯å¤é£æƒè°‹å°è¯´ä½œè€…ã€‚
å½“å‰å¤©æ•°:${game.day}
çŠ¶æ€:${JSON.stringify(game)}
è¯·ç»§ç»­å‰§æƒ…ï¼Œä½“ç°æƒæ–—ã€æƒ…æ„Ÿã€å±æœºå˜åŒ–ï¼Œä¸è¶…è¿‡150å­—ã€‚`;

try{
const res=await fetch(API_URL,{
method:"POST",
headers:{
"Content-Type":"application/json",
"Authorization":"Bearer "+API_KEY
},
body:JSON.stringify({
model:"gpt-3.5-turbo",
messages:[{role:"user",content:prompt}]
})
});

const data=await res.json();

game.story=data.choices[0].message.content;

save();
render();
}catch(e){
alert("AIè¯·æ±‚å¤±è´¥ï¼š"+e);
}
}

load();
render();
</script>

</body>
</html>
